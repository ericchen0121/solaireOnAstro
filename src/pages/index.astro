---
import BaseLayout from "../layouts/BaseLayout.astro";
import Odometer from "../components/react/Odometer.tsx";
---

<BaseLayout title="Rochat Solaire - Home">
  <!-- Section 1: Headline -->
  <section
    id="hero-trigger"
    class="hero h-screen flex items-center justify-center bg-black text-white"
  >
    <div id="hero-content" class="container mx-auto px-4">
      <h1 class="font-f37moon-light hero-title text-left max-w-6xl md:max-w-6xl max-w-none">
        <!-- Desktop version -->
        <span class="hidden md:inline">Le soleil produit en une</span><br class="hidden md:block" />
        <span class="hidden md:inline">heure ce que l'humanit√©</span><br class="hidden md:block" />
        <span id="last-span" class="last-span hidden md:inline">consomme en un an.</span>
        
        <!-- Mobile version with better line breaks -->
        <span class="md:hidden">Le soleil produit</span><br class="md:hidden" />
        <span class="md:hidden">en une heure ce que</span><br class="md:hidden" />
        <span class="md:hidden">l'humanit√© consomme</span><br class="md:hidden" />
        <span id="last-span-mobile" class="last-span md:hidden">en un an.</span>
      </h1>
    </div>
  </section>

  <!-- Section 2: Company Name -->
  <section
    class="company-name-section h-screen flex items-end justify-center bg-black text-white pb-8 md:pb-12 lg:pb-16"
  >
    <div class="container mx-auto w-full">
      <h2
        class="company-name-title text-7xl md:text-8xl lg:text-9xl xl:text-[12rem] font-bold text-center leading-none"
      >
        <span class="font-f37moon-demi font-bold">Rochat</span>
        <span class="font-f37moon-light">Solaire</span>
      </h2>
    </div>
  </section>

  <!-- Section 3: Stats -->
  <section
    class="stats-section h-screen flex items-center justify-center bg-black text-white py-20"
  >
    <div class="container mx-auto px-4 w-full">
      <div
        class="grid grid-cols-1 md:grid-cols-3 gap-12 md:gap-16 max-w-7xl mx-auto"
      >
        <!-- Stat 1: 1482 -->
        <div>
          <Odometer
            client:only="react"
            value={1482}
            duration={2}
            delay={0}
            className="stat-number text-white mb-6"
          />
          <p class="text-base md:text-lg leading-relaxed text-white/90">
            Vinet Rochat exploite le flu des rivi√®res √† la vall√©e de Joux, une
            source d'√©nergie renouvelable que nous a accord√©e la nature.
          </p>
        </div>

        <!-- Stat 2: 2007 -->
        <div>
          <Odometer
            client:only="react"
            value={2007}
            duration={2}
            delay={0.5}
            className="stat-number text-white mb-6"
          />
          <p class="text-base md:text-lg leading-relaxed text-white/90">
            D√®s 2007, pionniers en production d'√©nergie photovolta√Øque, conseil,
            investissement et service clients.
          </p>
        </div>

        <!-- Stat 3: 15 -->
        <div>
          <Odometer
            client:only="react"
            value={15}
            duration={1.5}
            delay={1.0}
            className="stat-number text-white mb-6"
          />
          <p class="text-base md:text-lg leading-relaxed text-white/90">
            fois plus d'√©nergie est produite par un module qu'il ne faut pour le
            produire.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 4: Video Background -->
  <section
    class="video-section relative h-screen w-screen flex items-center justify-center overflow-hidden text-align-left"
  >
    <video
      autoplay
      loop
      muted
      playsinline
      class="absolute inset-0 w-full h-full object-cover"
    >
      <source src="/romande_r1.mp4" type="video/mp4" />
    </video>

    <div class="relative z-10 text-left px-4">
      <h2
        class="font-f37moon-light text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light text-white leading-tight"
      >
        Un r√©seau romand,<br />
        bas√© sur la confiance.
      </h2>
    </div>
  </section>

  <!-- Section 5 -->
  <section
    class="why-solar-section h-screen w-screen flex items-center justify-center bg-black text-white"
  >
    <a href="/why-solar">
      <h2
        id="why-solar-text"
        class="text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light text-center px-4 cursor-pointer hover:opacity-80 transition-opacity"
      >
        Pourquoi le solaire?
      </h2>
    </a>
  </section>

  <!-- Section 6 -->
  <section
    class="why-us-section h-screen w-screen flex items-center justify-center bg-black text-white"
  >
    <a href="/why-work-with-us">
      <h2
        id="why-us-text"
        class="text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light text-center px-4 cursor-pointer hover:opacity-80 transition-opacity"
      >
        Pourquoi travailler avec nous?
      </h2>
    </a>
  </section>

  <!-- Section 7 -->
  <section
    class="clients-section h-screen w-screen flex items-center justify-center bg-black text-white"
  >
    <a href="/clients">
      <h2
        id="clients-text"
        class="text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light text-center px-4 cursor-pointer hover:opacity-80 transition-opacity"
      >
        Qui sont nos clients?
      </h2>
    </a>
  </section>

  <!-- Section 8: Projets -->
  <section
    class="projets-section h-screen w-screen flex items-center justify-center bg-black text-white"
  >
    <a href="/projets">
      <h2
        id="projets-text"
        class="text-6xl md:text-7xl lg:text-8xl xl:text-9xl font-bold text-center px-4 cursor-pointer hover:opacity-80 transition-opacity"
      >
        Projets
      </h2>
    </a>
  </section>

  <!-- Section 9: Contact -->
  <section
    class="contact-section h-screen w-screen flex items-center justify-center bg-black text-white"
  >
    <a
      id="contact-text"
      href="mailto:Info@rochatsolaire.ch"
      class="font-f37moon-light text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light text-center px-4 hover:opacity-80 transition-opacity duration-300"
    >
      Contact
    </a>
  </section>
</BaseLayout>

<!-- ====================== -->
<!--  NATIVE SCROLL VERSION -->
<!-- ====================== -->

<script>
  // @ts-nocheck
  import { initLetterReveal } from "../animations/letterReveal";
  import { initHeroScrollAnimation } from "../animations/heroScrollAnimation";
  import { initScrollLetterReveal } from "../animations/scrollLetterReveal";
  import {
    initSectionSnap,
    setSectionSnapAnimationActive,
  } from "../animations/sectionSnap";

  // Using native browser scrolling for better section snap reliability
  // ScrollTrigger works natively with window scrolling

  if (typeof window !== "undefined") {
    let cleanupScrollAnimation = null;
    let cleanupSectionSnap = null;
    const cleanupFunctions = [];

    function initAnimations() {
      console.log("üé¨ initAnimations called");
      // 1. Letter reveal for hero - MUST run first before any other animations
      // Wait for next frame to ensure DOM is ready
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          console.log("üé¨ Calling initLetterReveal");
          initLetterReveal(".hero-title", 0, 0.05);

          // 2. Section snapping (automatically disabled during hero animation)
          cleanupSectionSnap = initSectionSnap({
            threshold: 0.05,
            snapDuration: 0.25,
            sections: [
              "#hero-trigger",
              ".company-name-section",
              ".stats-section",
              ".video-section",
              ".why-solar-section",
              ".why-us-section",
              ".clients-section",
              ".projets-section",
              ".contact-section",
            ],
          });

          // 3. Hero scroll animation - start after letter reveal is set up
          setTimeout(() => {
            cleanupScrollAnimation = initHeroScrollAnimation({
              triggerSelector: "#hero-trigger",
              contentSelector: "#hero-content",
              lastSpanSelector: "#last-span, #last-span-mobile", // Target both desktop and mobile
              markers: false,
              onHeroComplete: () => {
                // Hero animation complete - snapping is now enabled automatically
              },
            });
          }, 200);
        });
      });

      // 4. Scroll letter reveals
      cleanupFunctions.push(initScrollLetterReveal("#why-solar-text", 0.07));
      cleanupFunctions.push(initScrollLetterReveal("#why-us-text", 0.07));
      cleanupFunctions.push(initScrollLetterReveal("#clients-text", 0.07));
      cleanupFunctions.push(initScrollLetterReveal("#projets-text", 0.1));
      cleanupFunctions.push(initScrollLetterReveal("#contact-text", 0.1));
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initAnimations);
    } else {
      initAnimations();
    }

    window.addEventListener("beforeunload", () => {
      cleanupScrollAnimation?.();
      cleanupSectionSnap?.();
      cleanupFunctions.forEach((fn) => fn());
    });
  }
</script>
